{% extends 'pagesbase.html' %}
{% block head %}
{{ super() }}
{% endblock %}

{% block body %}
<h1>Upload files</h1>
    <div><p id="alertMessage"></p></div>
    <p >{{message}}</p>
    <!--
    <div><input type='file' accept='*.xrslog|text/plain' id="file_upload" class="inputfile" enctype="multipart/form-data"></div>

    <div><input type='file' accept='*.xrslog|text/plain' id="resource_upload" class="inputfile" enctype="multipart/form-data"></div>
  -->
    <div class="progress">
      <div class="progress-bar" role="progressbar" aria-valuenow="70"
      aria-valuemin="0" aria-valuemax="100" style="width:0%">
        0%
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>label</th>
            <th>logger</th>
            <th>resource</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>label</th>
            <th><div><input type='file' accept='*.xrslog|text/plain' id="file_upload" class="inputfile" enctype="multipart/form-data"></div></th>
            <th><div><input type='file' accept='*.xrslog|text/plain' id="resource_upload" class="inputfile" enctype="multipart/form-data"></div></th>
          </tr>
        </tbody>

      </table>
    </div>

    <div><p id="log"></p></div>

    {{ pagination.info }}
    {{ pagination.links }}
    <div class="table-responsive">
      <table class="table table-hover">
      <thead>
        <tr>
          <th>#</th>
          <th>dbid</th>
          <th>Image View Log</th>
          <th>HWInfo Log</th>
          <th>Workstation</th>
        </tr>
      </thead>
      <tbody>
        {% for page in pages %}
          <tr>
            <td>{{ loop.index + (pagination.page-1)*pagination.per_page }}</td>
            <td>{{page.dbid}}</td>
            <td> {% if page.ivlog %} <a href="/api/pages/{{page.dbid}}">{{page.ivlog}}</a> {% else %} {{page.ivlog}} {% endif %}</td>
            <td>{{page.hwlog}}</td>
            <td>{{page.machinename}}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    </div>
    {{ pagination.links }}
{% endblock %}

{% block js %}
$(document).ready(function(){

  ///////////////////////////////
  function generateAlert(msg, type="success"){
    var words = '<div class="alert alert-' + type  + ' alert-dismissible">' +
                '<button type="button" class="close" data-dismiss="alert">&times;</button> ' +
                 msg + '</div>';
          return words;
  }
  ///////////////////////////////
  var dbid = 0;

  $('.progress-bar').hide();
  var add = false;
  namespace = '/test';
  // connect to the socket : http://do
  var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
  socket.on('connect', function() {
      socket.emit('my event', {sid: socket.io.engine.id, data: 'I\'m connected! (' + socket.io.engine.id + ')'});
  });
  socket.on('disconnect', function() {
      $('#log').append('<br>Disconnected');
  });
  socket.on('my response', function(msg) {
      $('#log').append('<br>Message: ' + msg.data);
  });
  socket.on('alert message', function(msg) {
      $('#alertMessage').append(generateAlert(msg.data));
  });
  socket.on('upload completed', function(msg) {
      $('#alertMessage').append(generateAlert(msg.data));
  });

  $(function () {
      //then load the JavaScript file
      $.getScript('/static/fileLoadtoServer.js', function(){
        $('#file_upload').on('change', {'postProcessFunc': 'load_NGLog', 'dbid': dbid, 'socket' : socket}, fileLoadtoServer);
        $('#resource_upload').on('change', {'postProcessFunc': 'load_csvResource', 'dbid': dbid, 'socket' : socket}, fileLoadtoServer);
      });
  });

});

{% endblock %}
